# SonarQube Setup

This document provides instructions for setting up and using SonarQube for code quality analysis in this project.

## Initial Setup

SonarQube analysis is integrated into the GitHub Actions workflow. To enable it, you need to configure a secret in the GitHub repository.

### 1. Obtain a SonarQube Token

First, you need a token from our SonarQube instance. If you don't have one, generate a new token in your SonarQube user settings.

### 2. Add the Token to GitHub Secrets

1.  Go to your repository's **Settings > Secrets and variables > Actions**.
2.  Click **New repository secret**.
3.  For the **Name**, enter `SONAR_TOKEN`.
4.  For the **Value**, paste your SonarQube token.
5.  Click **Add secret**.

## Automatic Analysis

SonarQube analysis runs automatically on every push and pull request to the `main` branch. The workflow is defined in `.github/workflows/build.yml`.

The workflow will:

1.  Install dependencies.
2.  Run tests and generate a code coverage report.
3.  Send the analysis report to SonarQube.
4.  Check the Quality Gate status and fail the workflow if it's not `PASSED`.

## Running Analysis Locally

To run the SonarQube analysis locally, you need to have the `sonar-scanner` CLI tool installed.

1.  **Install `sonar-scanner`**: Follow the official instructions for your operating system.
2.  **Run the scanner**: From the root of the project, run the following command:

    ```bash
    sonar-scanner -Dsonar.token=YOUR_SONAR_TOKEN
    ```

    Replace `YOUR_SONAR_TOKEN` with your personal SonarQube token.

## Interpreting Sonar Reports

After an analysis is complete, you can view the report on the SonarQube dashboard .

The main things to look for are:

*   **Quality Gate**: This is the main indicator of your project's health. It should be `PASSED`.
*   **Bugs, Vulnerabilities, and Code Smells**: These are issues found in your code. Click on them to see the details and the location in the code.
*   **Coverage**: This shows the percentage of your code that is covered by tests. Aim for a high coverage percentage.
*   **Duplications**: This shows the percentage of duplicated code in your project. Try to keep this number low.

By regularly checking the SonarQube dashboard and fixing the issues it reports, we can maintain a high level of code quality.

## Configuration Details

This section explains the changes made to the project files to enable SonarQube integration.

### `sonar-project.properties`

This file was created in the root of the project to configure the SonarQube scanner.

-   `sonar.projectKey`: A unique identifier for the project in SonarQube.
-   `sonar.projectName`: The display name of the project in SonarQube.
-   `sonar.projectVersion`: The version of the project.
-   `sonar.sources`: The path to the source code files. This is set to `./fronted` and  `./packages`  to include all packages in the monorepo.
-   `sonar.tests`: The path to the test files. This is also set to `./fronted` and  `./packages` .
-   `sonar.test.inclusions`: A comma-separated list of patterns to identify test files.
-   `sonar.javascript.lcov.reportPaths`: The path to the code coverage report generated by Jest.

### `jest.config.js`

This file was updated to configure Jest to generate a code coverage report.

-   `collectCoverage: true`: This tells Jest to collect coverage information.
-   `coverageReporters: ["lcov", "text"]`: This specifies the formats for the coverage report. `lcov` is used by SonarQube.
-   `coverageDirectory: "coverage"`: This sets the directory where the coverage report will be generated.

### `package.json`

A new script was added to `package.json` to run tests with coverage.

-   `"test:coverage": "jest --coverage"`: This script runs Jest and generates the coverage report.

### `.github/workflows/build.yml`

The GitHub Actions workflow was updated to automate the SonarQube analysis.

-   **Trigger**: The workflow now runs on push and pull requests to the `main` branch.
-   **Jobs**: The `build` job was updated with the following steps:
    1.  **Checkout**: Checks out the code.
    2.  **Set up pnpm**: Installs `pnpm`.
    3.  **Set up Node.js**: Installs Node.js.
    4.  **Install dependencies**: Installs project dependencies using `pnpm install`.
    5.  **Test and coverage**: Runs the `test:coverage` script to generate the coverage report.
    6.  **SonarQube scan**: Runs the SonarQube scanner to analyze the code and upload the report.
    7.  **SonarQube quality gate**: Checks the Quality Gate status in SonarQube and fails the workflow if it's not `PASSED`.